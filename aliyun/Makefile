# é˜¿é‡Œäº‘è¯­éŸ³è¯†åˆ«é¡¹ç›® Makefile

.PHONY: help install setup test demo clean

# é»˜è®¤ç›®æ ‡
help:
	@echo "é˜¿é‡Œäº‘è¯­éŸ³è¯†åˆ«é¡¹ç›®"
	@echo "===================="
	@echo ""
	@echo "å¯ç”¨å‘½ä»¤:"
	@echo "  install    - å®‰è£…ä¾èµ–åŒ…"
	@echo "  setup      - é…ç½®ç¯å¢ƒ"
	@echo "  check      - æ£€æŸ¥é…ç½®"
	@echo "  test       - è¿è¡Œæµ‹è¯•"
	@echo "  demo       - è¿è¡Œæ¼”ç¤º"
	@echo "  clean      - æ¸…ç†ä¸´æ—¶æ–‡ä»¶"
	@echo "  example    - è¿è¡Œç¤ºä¾‹"
	@echo ""
	@echo "ä½¿ç”¨ç¤ºä¾‹:"
	@echo "  make install"
	@echo "  make setup"
	@echo "  make demo"

# å®‰è£…ä¾èµ–
install:
	@echo "ğŸ“¦ å®‰è£…ä¾èµ–åŒ…..."
	pip install -r requirements.txt
	@echo "âœ… ä¾èµ–å®‰è£…å®Œæˆ"

# ç¯å¢ƒé…ç½®
setup:
	@echo "ğŸ”§ é…ç½®ç¯å¢ƒ..."
	python setup_env.py

# æ£€æŸ¥é…ç½®
check:
	@echo "ğŸ” æ£€æŸ¥é…ç½®..."
	python check_config.py

# è¿è¡Œæµ‹è¯•
test:
	@echo "ğŸ§ª è¿è¡Œæµ‹è¯•..."
	python test_aliyun_asr.py

# è¿è¡Œæ¼”ç¤º
demo:
	@echo "ğŸš€ å¯åŠ¨æ¼”ç¤º..."
	python demo.py

# è¿è¡Œç¤ºä¾‹
example:
	@echo "ğŸ“ è¿è¡Œç¤ºä¾‹..."
	@if [ -f example.py ]; then \
		python example.py; \
	else \
		echo "âŒ example.py ä¸å­˜åœ¨ï¼Œè¯·å…ˆè¿è¡Œ make setup"; \
	fi

# æ¸…ç†ä¸´æ—¶æ–‡ä»¶
clean:
	@echo "ğŸ§¹ æ¸…ç†ä¸´æ—¶æ–‡ä»¶..."
	find . -name "*.pyc" -delete
	find . -name "__pycache__" -type d -exec rm -rf {} + 2>/dev/null || true
	find . -name "*.log" -delete
	rm -rf demo_output/
	rm -rf test_output/
	@echo "âœ… æ¸…ç†å®Œæˆ"

# æ£€æŸ¥ä»£ç é£æ ¼
lint:
	@echo "ğŸ” æ£€æŸ¥ä»£ç é£æ ¼..."
	@if command -v flake8 >/dev/null 2>&1; then \
		flake8 *.py --max-line-length=100 --ignore=E501,W503; \
	else \
		echo "âš ï¸  flake8 æœªå®‰è£…ï¼Œè·³è¿‡ä»£ç é£æ ¼æ£€æŸ¥"; \
	fi

# æ ¼å¼åŒ–ä»£ç 
format:
	@echo "ğŸ¨ æ ¼å¼åŒ–ä»£ç ..."
	@if command -v black >/dev/null 2>&1; then \
		black *.py --line-length=100; \
	else \
		echo "âš ï¸  black æœªå®‰è£…ï¼Œè·³è¿‡ä»£ç æ ¼å¼åŒ–"; \
	fi

# ç”Ÿæˆæ–‡æ¡£
docs:
	@echo "ğŸ“š ç”Ÿæˆæ–‡æ¡£..."
	@if command -v pydoc >/dev/null 2>&1; then \
		pydoc -w aliyun_asr; \
		pydoc -w output_formatter; \
		pydoc -w config; \
		echo "âœ… æ–‡æ¡£ç”Ÿæˆå®Œæˆ"; \
	else \
		echo "âš ï¸  pydoc æœªæ‰¾åˆ°"; \
	fi

# æ‰“åŒ…é¡¹ç›®
package:
	@echo "ğŸ“¦ æ‰“åŒ…é¡¹ç›®..."
	tar -czf aliyun_asr.tar.gz *.py requirements.txt README.md Makefile
	@echo "âœ… æ‰“åŒ…å®Œæˆ: aliyun_asr.tar.gz"

# æ˜¾ç¤ºé¡¹ç›®ä¿¡æ¯
info:
	@echo "é¡¹ç›®ä¿¡æ¯"
	@echo "========"
	@echo "åç§°: é˜¿é‡Œäº‘è¯­éŸ³è¯†åˆ«"
	@echo "ç‰ˆæœ¬: 1.0.0"
	@echo "ä½œè€…: AI Assistant"
	@echo "æè¿°: åŸºäºé˜¿é‡Œäº‘æ™ºèƒ½è¯­éŸ³äº¤äº’æœåŠ¡çš„è¯­éŸ³è½¬æ–‡å­—è§£å†³æ–¹æ¡ˆ"
	@echo ""
	@echo "æ–‡ä»¶åˆ—è¡¨:"
	@ls -la *.py | awk '{print "  " $$9 " (" $$5 " bytes)"}'
	@echo ""
	@echo "Pythonç‰ˆæœ¬: $(shell python --version)"
	@echo "å½“å‰ç›®å½•: $(shell pwd)"
